import base64
import datetime


def get_saml_response():
    now = datetime.datetime.utcnow()
    formatted = now.strftime("%Y-%m-%dT%H:%M:%S.000Z")
    timestamped = XML_STR.replace("ISSUE_INSTANT", formatted)
    return base64.b64encode(timestamped.encode("utf8")).decode("utf8")


CERT = "TEST"

XML_STR = """<samlp:Response ID="_55b91471-9a0c-407a-b8a1-b78af1b1b8d6" Version="2.0" IssueInstant="ISSUE_INSTANT" Destination="localhost/sso/acs/7410c6d0-54f5-4841-af01-279e52f04eb0/" InResponseTo="id-1VNpo6RwogCYGLXXb" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"><Issuer xmlns="urn:oasis:names:tc:SAML:2.0:assertion">https://sts.windows.net/f0f64571-ea38-4778-908d-0119fcb190f0/</Issuer><samlp:Status><samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/></samlp:Status><Assertion ID="_2b3a04f1-fc09-475a-8e30-a3d9386e1300" IssueInstant="2021-10-06T09:50:46.490Z" Version="2.0" xmlns="urn:oasis:names:tc:SAML:2.0:assertion"><Issuer>https://sts.windows.net/f0f64571-ea38-4778-908d-0119fcb190f0/</Issuer><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/><SignatureMethod Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/><Reference URI="#_2b3a04f1-fc09-475a-8e30-a3d9386e1300"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/><Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/><DigestValue>VhSd6h5t8DT+8GRWUDCW+o0I5OXchpT/Q+cdel2v65I=</DigestValue></Reference></SignedInfo><SignatureValue>CTFzIXkQryoBT2jadzn4xD8X49RuX0eVKyd36k2tCU+arXPif8IiVr4SGyYskJotSgzSY120m7/TSAWrwXPnOSvg6GGvrfpLzUXuJjfau/dtPAuVF8rfkoDNkrX4nFw5mDwfSVyOBAHEwRKyyGnA28dEVhuXhfE4WMGm7LHTXHR6Kc/MeIO+/DRIsHh0jxs66NTA61to4bYyxooFvzFDIi+A+t5vZOE3pu5bN1Co5kIS9csoBOgWq70kSvCwhzc+WtyWPT0wu04ZGKupTvzFrHSt0Z+RQXVMm6T4rDAaOl5c8+dLmQm2F8HMVaZN2/Tk7GK7D27gtTLwIvZdDMcftA==</SignatureValue><KeyInfo><X509Data><X509Certificate>TestCert</X509Certificate></X509Data></KeyInfo></Signature><Subject><NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">stuart_quin.team#EXT#@stuartquin.onmicrosoft.com</NameID><SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"><SubjectConfirmationData InResponseTo="id-1VNpo6RwogCYGLXXb" NotOnOrAfter="ISSUE_INSTANT" Recipient="localhost/sso/acs/7410c6d0-54f5-4841-af01-279e52f04eb0/"/></SubjectConfirmation></Subject><Conditions NotBefore="2021-10-06T09:45:46.178Z" NotOnOrAfter="ISSUE_INSTANT"><AudienceRestriction><Audience>localhost/sso/signin/7410c6d0-54f5-4841-af01-279e52f04eb0/</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name="http://schemas.microsoft.com/identity/claims/tenantid"><AttributeValue>f0f64571-ea38-4778-908d-0119fcb190f0</AttributeValue></Attribute><Attribute Name="http://schemas.microsoft.com/identity/claims/objectidentifier"><AttributeValue>62a92c99-63c5-482d-8a24-201e7ea0b477</AttributeValue></Attribute><Attribute Name="http://schemas.microsoft.com/identity/claims/displayname"><AttributeValue>Stuart Quin</AttributeValue></Attribute><Attribute Name="http://schemas.microsoft.com/identity/claims/identityprovider"><AttributeValue>live.com</AttributeValue></Attribute><Attribute Name="http://schemas.microsoft.com/claims/authnmethodsreferences"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/unspecified</AttributeValue></Attribute><Attribute Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"><AttributeValue>Stuart</AttributeValue></Attribute><Attribute Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"><AttributeValue>Quin</AttributeValue></Attribute><Attribute Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"><AttributeValue>stuart@quin.team</AttributeValue></Attribute><Attribute Name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"><AttributeValue>stuart_quin.team#EXT#@stuartquin.onmicrosoft.com</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant="2021-10-05T08:02:41.960Z" SessionIndex="_2b3a04f1-fc09-475a-8e30-a3d9386e1300"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>"""
